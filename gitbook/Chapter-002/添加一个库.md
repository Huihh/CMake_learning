# Chapter-002:添加一个库

现在我们为我们工程添加一个库。这个库包含我们自己实现的计算一个数的平方根。可执行程序使用我们自己的这个库替代编译器提供的标准库中的计算平方根的函数。

在该教程中，我们把库放在名称为 ```MathFunctions``` 的子目录中。在该目录下创建一个名为 ```MathFunctions.h``` 的头文件和一个名为 ```mysqrt.c``` 的源文件。源文件中实现一个和标准库函数 ```sqrt``` 功能类似的函数 ```mysqrt``` 。

创建 ```CMakeLists.txt ``` 文件，并添加如下内容：

```cmake

# 生成 Mysqrt 库
add_library(Mysqrt mysqrt.c)
```



为了使用上一步生成的库，则需要在顶层的 ```CMakeLists.txt``` 中使用 ```add_subdirectory()``` 将目录包含进来。还需要在头文件包含路径中将库的头文件包含进来。最终顶层的 ```CMakeLists.txt``` 内容如下：

```cmake

# 要求 CMake 的最低版本
cmake_minimum_required(VERSION 3.13)

# 工程名称
project(Tutorial)

# 添加 MathFunctions 子目录 
# Note: 必须位于 project() 之后
add_subdirectory(MathFunctions)

# 可执行文件
add_executable(Tutorial main.c)

# 使用 Mysqrt 库 
target_link_libraries(Tutorial PUBLIC Mysqrt)

# 添加头文件包含路径
target_include_directories(Tutorial PUBLIC
    "${PROJECT_BINARY_DIR}"
    "${PROJECT_SOURCE_DIR}/MathFunctions"
) 

```



## 使用 CMake 构建

- 在工程跟目录下建立 build 目录，并进入该目录

  ```$ mkdir build && cd build```

- 使用 ```CMake``` 构建工程

  ```$ cmake ../``` or

  ```$ cmake -GNinja ../```

- 使用 ```make``` or ```ninja``` 编译工程

  ```$ make``` or

  ```$ ninja```

- 运行生成的可执行文件

  ```./Tutorial``` 

  此时则可以看到终端输出如下内容：

  ```c
  Using mysqrt library
  70.000000 sqrt is 8.366600
  ```

  



 





































