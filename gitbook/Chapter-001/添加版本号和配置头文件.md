# 添加版本号和配置头文件

我们先为我们的工程添加一个版本号。虽然我们可以在源代码中这么做，但在 ```CMakeLists.txt``` 中做会更灵活。

首先，修改 ```CMakeLists.txt``` 文件中的 ```project()``` 命令，设置名称和版本号。

其次，通过配置头文件将版本信息传递给源代码。

最后，将二进制树目录添加到头文件搜索路径中。

最终的 ```CMakeLists.txt``` 文件内容如下：

```cmake
# 要求 CMake 的最低版本
cmake_minimum_required(VERSION 3.13)

# 工程名称和版本号
project(Tutorial VERSION 1.0)

# 可执行文件, 必须位于 target_include_directories() 之前
add_executable(Tutorial main.c)

# 配置文件将版本号传给源码文件 (TutorialConfig.h)
configure_file(TutorialConfig.h.in TutorialConfig.h)

# 配置文件会写入二进制树，需要将二进制目录添加到头文件包含路径中
target_include_directories(Tutorial PUBLIC
    "${PROJECT_BINARY_DIR}"
)


```



创建配置头文件 ```TutorialConfig.h.in```，并添加如下内容：

```cmake
#define Tutorial_VERSION_MAJOR @Tutorial_VERSION_MAJOR@
#define Tutorial_VERSION_MINOR @Tutorial_VERSION_MINOR@
```

配置文件 **Tutorial_VERSION_MAJOR** 和 **Tutorial_VERSION_MINOR** 的值会被 **@Tutorial_VERSION_MAJOR@** 和 **@Tutorial_VERSION_MINOR@** 替换。



修改测试代码，添加包含配置头文件，获取版本号，最终内容如下：

```c

#include <stdio.h>

#include "TutorialConfig.h"

int main(int argc, char *argv[])
{
    printf("Tutorial Version is %d.%d\n", Tutorial_VERSION_MAJOR, Tutorial_VERSION_MINOR);

    return 0;
}
```



## 使用 CMake 构建

- 在工程跟目录下建立 build 目录，并进入该目录

  ```$ mkdir build && cd build```

- 使用 ```CMake``` 构建工程

  ```$ cmake ../``` or

  ```$ cmake -GNinja ../```

- 使用 ```make``` or ```ninja``` 编译工程

  ```$ make``` or

  ```$ ninja```

- 运行生成的可执行文件

  ```./Tutorial``` 

  此时则可以看到终端输出 ```Tutorial Version is 1.0``` 字符串了。

































